<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrillTrack - Drilling Logs Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #4c1d95 100%);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #4c1d95 50%, #1d4ed8 100%);
        }
        .gradient-card {
            background: linear-gradient(145deg, #1e293b 0%, #1e1b4b 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        /* Enhanced table row styling */
        tr.plod-row {
            border-bottom: 2px solid rgba(71, 85, 105, 0.5);
            margin-bottom: 4px;
            background-color: rgba(51, 65, 85, 0.7);
        }
        
        tr.plod-row:hover {
            background-color: rgba(71, 85, 105, 0.8);
            box-shadow: 0 2px 4px -1px rgba(99, 102, 241, 0.2);
        }
        
        tr.activity-row {
            background-color: rgba(30, 41, 59, 0.4);
            border-left: 3px solid rgb(99, 102, 241);
        }
        
        tr.activity-row:hover {
            background-color: rgba(51, 65, 85, 0.3);
        }
        
        .activity-item {
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.3);
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <header class="gradient-bg sticky top-0 z-50 px-4 py-3 shadow-md">
        <div class="container mx-auto flex items-center">
            <i class="fas fa-clipboard-list text-2xl text-purple-300 mr-3"></i>
            <h1 class="text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-300 to-blue-300">DrillTrack</h1>
            <div class="ml-auto text-right hidden sm:block">
                <p class="text-sm text-slate-300">Current Shift</p>
                <p class="font-medium text-sm" id="currentDateTime"></p>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-2 md:px-4 pt-2 pb-4 md:pt-4 md:pb-8">

        <!-- Navigation -->
        <div class="flex bg-slate-800 rounded-lg p-1 mb-0 md:mb-6">
            <button id="logsNavBtn" class="flex-1 py-2 px-4 rounded-md font-medium text-center bg-slate-700 text-blue-300">
                <i class="fas fa-clipboard-list mr-2"></i> Plod History
            </button>
            <button id="formNavBtn" class="flex-1 py-2 px-4 rounded-md font-medium text-center text-slate-300 hover:bg-slate-700">
                <i class="fas fa-plus-circle mr-2"></i> New Plod
            </button>
            <button id="dashboardNavBtn" class="flex-1 py-2 px-4 rounded-md font-medium text-center text-slate-300 hover:bg-slate-700">
                <i class="fas fa-chart-line mr-2"></i> Dashboard
            </button>
        </div>

        <!-- Pages -->
        <div id="pagesContainer">
            <!-- Logs Table Page -->
            <div id="logsPage" class="page active">
                <!-- Data Table Section -->
                <section>
                    <div class="gradient-card rounded-xl p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                            <h2 class="text-2xl font-semibold text-purple-200 mb-4 md:mb-0">Drilling Log History</h2>
                            <div class="w-full md:w-auto">
                                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
                                    <select id="dateFilter" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="all">All Dates</option>
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                    </select>
                                    <select id="rigFilter" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="all">All Rigs</option>
                                        <option value="Rig 1">Rig 1</option>
                                        <option value="Rig 2">Rig 2</option>
                                        <option value="Rig 3">Rig 3</option>
                                        <option value="Rig 4">Rig 4</option>
                                        <option value="Rig 5">Rig 5</option>
                                        <option value="Rig 6">Rig 6</option>
                                        <option value="Rig 7">Rig 7</option>
                                        <option value="Rig 8">Rig 8</option>
                                    </select>
                                    <button id="exportBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg flex items-center">
                                        <i class="fas fa-file-export mr-2"></i> Export CSV
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-700">
                                <thead class="bg-slate-800">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="date">
                                            Date <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="shift">
                                            Shift <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="crew">
                                            Crew <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="holeId">
                                            Hole ID <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="rig">
                                            Rig # <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="rigType">
                                            Rig Type <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider cursor-pointer sortable" data-column="meters">
                                            Meters <i class="fas fa-sort ml-1"></i>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
                                            Activities
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">
                                            Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="logTableBody" class="bg-slate-800 divide-y divide-slate-700">
                                    <!-- Table rows will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-4 text-sm text-slate-400">
                            <div id="tableInfo">Showing 0 to 0 of 0 entries</div>
                            <div class="flex space-x-2" id="pagination">
                                <!-- Pagination will be added here -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Form Page -->
            <div id="formPage" class="page">
                <!-- Form Section -->
                <section id="formSection" class="mb-12">
                    <div class="gradient-card rounded-xl p-6 mb-8">
                        <h2 class="text-2xl font-semibold mb-6 text-purple-200">New Drilling Log Entry</h2>
                        
                        <form id="drillingLogForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label for="shiftDate" class="block text-sm font-medium text-slate-300 mb-1">Shift Date</label>
                                    <input type="date" id="shiftDate" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label for="shiftType" class="block text-sm font-medium text-slate-300 mb-1">Shift Type</label>
                                    <select id="shiftType" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="">Select Shift</option>
                                        <option value="Day">Day Shift</option>
                                        <option value="Night">Night Shift</option>
                                       
                                    </select>
                                </div>
                                <div>
                                    <label for="crewName" class="block text-sm font-medium text-slate-300 mb-1">Crew Name</label>
                                    <input type="text" id="crewName" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Enter crew name">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="holeId" class="block text-sm font-medium text-slate-300 mb-1">Hole ID</label>
                                    <input type="text" id="holeId" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Enter hole ID">
                                </div>
                                <div>
                                    <label for="rigNumber" class="block text-sm font-medium text-slate-300 mb-1">Rig Number</label>
                                    <select id="rigNumber" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="">Select Rig</option>
                                        <option value="Rig 1">Rig 1</option>
                                        <option value="Rig 2">Rig 2</option>
                                        <option value="Rig 3">Rig 3</option>
                                        <option value="Rig 4">Rig 4</option>
                                        <option value="Rig 5">Rig 5</option>
                                        <option value="Rig 6">Rig 6</option>
                                        <option value="Rig 7">Rig 7</option>
                                        <option value="Rig 8">Rig 8</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="rigType" class="block text-sm font-medium text-slate-300 mb-1">Rig Type</label>
                                    <select id="rigType" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="">Select Type</option>
                                        <option value="RC">RC</option>
                                        <option value="Diamond">Diamond</option>
                                        <option value="Hydro">Hydro</option>
                                        <option value="Sonic">Sonic</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="totalMeters" class="block text-sm font-medium text-slate-300 mb-1">Total Meters Drilled</label>
                                    <input type="number" id="totalMeters" step="0.01" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Enter meters">
                                </div>
                            </div>

                            <div>
                                <label for="notes" class="block text-sm font-medium text-slate-300 mb-1">Notes</label>
                                <textarea id="notes" rows="3" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Any additional notes..."></textarea>
                            </div>

                            <div class="border-t border-slate-700 pt-6">
                                <h3 class="text-lg font-medium text-blue-200 mb-4">Activity Timeline</h3>
                                <div id="activityContainer" class="space-y-4 max-h-96 overflow-y-auto scrollbar-hide p-2">
                                    <!-- Activity items will be added here -->
                                </div>
                                <button type="button" id="addActivityBtn" class="mt-4 flex items-center text-blue-300 hover:text-blue-400 transition-colors">
                                    <i class="fas fa-plus-circle mr-2"></i> Add Activity
                                </button>
                            </div>

                            <div class="flex justify-end space-x-4 pt-4">
                                <button type="reset" class="px-6 py-2 border border-slate-600 text-slate-300 rounded-lg hover:bg-slate-800 transition-colors">Clear Form</button>
                                <button type="submit" id="formSubmitBtn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center">
                                    <i class="fas fa-save mr-2"></i> Save Log
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page">
                <div class="gradient-card rounded-xl p-6 mb-8">
                    <h2 class="text-2xl font-semibold mb-6 text-purple-200">Drilling Analytics Dashboard</h2>
                    
                    <!-- Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Date Range</label>
                            <select id="dashboardDateFilter" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="week">Last 7 Days</option>
                                <option value="month">Last 30 Days</option>
                                <option value="quarter">Last 90 Days</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Rig Filter</label>
                            <select id="dashboardRigFilter" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="all">All Rigs</option>
                                <option value="Rig 1">Rig 1</option>
                                <option value="Rig 2">Rig 2</option>
                                <option value="Rig 3">Rig 3</option>
                                <option value="Rig 4">Rig 4</option>
                                <option value="Rig 5">Rig 5</option>
                                <option value="Rig 6">Rig 6</option>
                                <option value="Rig 7">Rig 7</option>
                                <option value="Rig 8">Rig 8</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Shift Filter</label>
                            <select id="dashboardShiftFilter" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="all">All Shifts</option>
                                <option value="Day">Day Shift</option>
                                <option value="Night">Night Shift</option>
                                
                            </select>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="space-y-6">
                        <div class="gradient-card rounded-xl p-4">
                            <h3 class="text-lg font-medium text-blue-200 mb-4">Meters Drilled Per Day</h3>
                            <div class="relative h-full min-h-[300px] md:h-80">
                                <canvas id="metersChart"></canvas>
                            </div>
                        </div>
                        <div class="gradient-card rounded-xl p-4">
                            <h3 class="text-lg font-medium text-purple-200 mb-4">Rig Performance Comparison (Meters per Shift)</h3>
                            <div class="relative h-60 md:h-80">
                                <canvas id="rigsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Modal -->
        <div id="activityModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-purple-200">Add Activity</h3>
                    <button id="closeModalBtn" class="text-slate-400 hover:text-slate-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="activityForm" class="space-y-4">
                    <div>
                        <label for="activityStartTime" class="block text-sm font-medium text-slate-300 mb-1">Start Time</label>
                        <input type="time" id="activityStartTime" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="activityEndTime" class="block text-sm font-medium text-slate-300 mb-1">End Time</label>
                        <input type="time" id="activityEndTime" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="activityType" class="block text-sm font-medium text-slate-300 mb-1">Activity Type</label>
                        <select id="activityType" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">Select Activity</option>
                            <option value="Drilling">Drilling</option>
                            <option value="Weather - Standby">Weather</option>
                            <option value="Casing">Casing</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Breakdown">Breakdown</option>
                            <option value="Standby">Standby</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="activityDescription" class="block text-sm font-medium text-slate-300 mb-1">Description</label>
                        <textarea id="activityDescription" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Activity details..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 pt-2">
                        <button type="button" id="cancelActivityBtn" class="px-4 py-2 border border-slate-600 text-slate-300 rounded-lg hover:bg-slate-700 transition-colors">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">Add Activity</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- View Log Modal -->
        <div id="viewLogModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-slate-800 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-blue-200">Drilling Log Details</h3>
                    <button id="closeViewModalBtn" class="text-slate-400 hover:text-slate-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="logDetailsContent">
                    <!-- Log details will be inserted here -->
                </div>
            </div>
        </div>

    <script>
        // Define default logs data
        const defaultPlods = [
            {
                id: 1001,
                date: new Date().toISOString().split('T')[0],
                shift: 'Day',
                crew: 'Crew Beta',
                holeId: 'RC-001',
                rig: 'Rig 1',
                rigType: 'RC',
                meters: 120.5,
                notes: 'Initial test hole - good progress',
                activities: [
                    {
                        id: 1,
                        startTime: '06:00',
                        endTime: '12:30',
                        type: 'Drilling',
                        description: 'Main drilling shift'
                    },
                    {
                        id: 2,
                        startTime: '12:30',
                        endTime: '14:00',
                        type: 'Maintenance',
                        description: 'Bit replacement'
                    }
                ],
                createdAt: new Date().toISOString()
            },
            {
                id: 1002,
                date: new Date(Date.now() - 86400000).toISOString().split('T')[0], // Yesterday
                shift: 'Night',
                crew: 'Crew Beta',
                holeId: 'RC-002',
                rig: 'Rig 1',
                rigType: 'Diamond',
                meters: 93,
                notes: 'Hard rock encountered',
                activities: [
                    {
                        id: 3,
                        startTime: '18:00',
                        endTime: '06:00',
                        type: 'Drilling',
                        description: 'Night shift drilling'
                    }
                ],
                createdAt: new Date(Date.now() - 86400000).toISOString()
            },
            {
                id: 1003,
                date: new Date(Date.now() - 172800000).toISOString().split('T')[0], // 2 days ago
                shift: 'Day',
                crew: 'Crew Gamma',
                holeId: 'RC-003',
                rig: 'Rig 1',
                rigType: 'Hydro',
                meters: 110,
                notes: 'Excellent progress today',
                activities: [
                    {
                        id: 4,
                        startTime: '06:00',
                        endTime: '17:00',
                        type: 'Drilling',
                        description: ''
                    }
                ],
                createdAt: new Date(Date.now() - 172800000).toISOString()
            },
            {
                id: 1003,
                date: new Date(Date.now() - 172800000).toISOString().split('T')[0], // 2 days ago
                shift: 'Day',
                crew: 'Crew Gamma',
                holeId: 'RC-004',
                rig: 'Rig 1',
                rigType: 'Hydro',
                meters: 110,
                notes: 'Excellent progress today',
                activities: [
                    {
                        id: 4,
                        startTime: '06:00',
                        endTime: '17:00',
                        type: 'Drilling',
                        description: ''
                    }
                ],
                createdAt: new Date(Date.now() - 172800000).toISOString()
            }
        ];

        // Initialize variables - seed with defaults if no logs exist
        if (localStorage.getItem('drillingLogs') === null) {
            localStorage.setItem('drillingLogs', JSON.stringify(defaultPlods));
        }
        let logs = JSON.parse(localStorage.getItem('drillingLogs')) || [];
        let currentActivityId = 5; // Start after default activity IDs
        let currentPage = 1;
        const rowsPerPage = 10;
        let sortColumn = 'date';
        let sortDirection = 'desc';

        // DOM Elements
        const drillingLogForm = document.getElementById('drillingLogForm');
        const activityContainer = document.getElementById('activityContainer');
        const addActivityBtn = document.getElementById('addActivityBtn');
        const activityModal = document.getElementById('activityModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const activityForm = document.getElementById('activityForm');
        const cancelActivityBtn = document.getElementById('cancelActivityBtn');
        const viewLogModal = document.getElementById('viewLogModal');
        const closeViewModalBtn = document.getElementById('closeViewModalBtn');
        const logDetailsContent = document.getElementById('logDetailsContent');
        const logTableBody = document.getElementById('logTableBody');
        const dateFilter = document.getElementById('dateFilter');
        const sortableHeaders = document.querySelectorAll('.sortable');
        const logsNavBtn = document.getElementById('logsNavBtn');
        const formNavBtn = document.getElementById('formNavBtn');
        const exportBtn = document.getElementById('exportBtn');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDateTime();
            setInterval(updateCurrentDateTime, 60000); // Update every minute
            
            loadLogs();
            renderTable();
            
            // Dashboard navigation
            const dashboardNavBtn = document.getElementById('dashboardNavBtn');
            dashboardNavBtn.addEventListener('click', () => {
                showPage('dashboardPage');
                // Always render charts when dashboard is shown
                if (metersChart) metersChart.destroy();
                if (rigsChart) rigsChart.destroy();
                renderDashboardCharts();
            });
            
            // Dashboard filter event listeners
            document.getElementById('dashboardDateFilter').addEventListener('change', renderDashboardCharts);
            document.getElementById('dashboardRigFilter').addEventListener('change', renderDashboardCharts);
            document.getElementById('dashboardShiftFilter').addEventListener('change', renderDashboardCharts);
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('shiftDate').value = today;
            
            // Navigation event listeners
            logsNavBtn.addEventListener('click', () => showPage('logsPage'));
            formNavBtn.addEventListener('click', () => showPage('formPage'));

            // Export button event listener
            exportBtn.addEventListener('click', exportToCSV);
        });

        // Export logs to CSV
        function exportToCSV() {
            if (logs.length === 0) {
                showToast('No logs to export', 'error');
                return;
            }

            // Create CSV content
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Add header row
            const headers = [
                "Type", 
                "Date", 
                "Shift", 
                "Crew", 
                "Rig Number",
                "Rig Type",
                "Meters Drilled", 
                "Notes",
                "Activity Type",
                "Activity Start",
                "Activity End",
                "Activity Description"
            ];
            csvContent += headers.join(",") + "\r\n";
            
            // Add data rows
            logs.forEach(log => {
                // Add summary row for the plod
                const summaryRow = [
                    `"Plod Summary"`,
                    `"${formatDate(log.date)}"`,
                    `"${log.shift}"`,
                    `"${log.crew}"`,
                    `"${log.rig}"`,
                    `"${log.rigType || ''}"`,
                    `"${log.meters.toFixed(2)}"`,
                    `"${log.notes || ''}"`,
                    `""`,
                    `""`,
                    `""`,
                    `""`
                ];
                csvContent += summaryRow.join(",") + "\r\n";
                
                // Add activity rows if they exist
                if (log.activities.length > 0) {
                    log.activities.forEach(activity => {
                        const activityRow = [
                            `"Activity"`,
                            `""`,
                            `""`,
                            `""`,
                            `""`,
                            `""`,
                            `""`,
                            `"${activity.type}"`,
                            `"${activity.startTime}"`,
                            `"${activity.endTime}"`,
                            `"${activity.description || ''}"`
                        ];
                        csvContent += activityRow.join(",") + "\r\n";
                    });
                }
                
                // Add empty row as separator
                csvContent += `"","","","","","","","","","",""\r\n`;
            });
            
            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `drilling_logs_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            
            // Trigger download
            link.click();
            document.body.removeChild(link);
            
            showToast('CSV export started', 'success');
        }

        // Show specific page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation buttons
            const navButtons = [logsNavBtn, formNavBtn];
            navButtons.forEach(btn => {
                btn.classList.remove('bg-slate-700', 'text-blue-300');
                btn.classList.add('text-slate-300', 'hover:bg-slate-700');
            });
            
            if (pageId === 'logsPage') {
                logsNavBtn.classList.add('bg-slate-700', 'text-blue-300');
                logsNavBtn.classList.remove('text-slate-300', 'hover:bg-slate-700');
            } else if (pageId === 'formPage') {
                formNavBtn.classList.add('bg-slate-700', 'text-blue-300');
                formNavBtn.classList.remove('text-slate-300', 'hover:bg-slate-700');
            }
        }

        // Update current date and time
        function updateCurrentDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
        }

        // Track if we're editing an existing log
        let currentEditLogId = null;

        // Handle form submission
        drillingLogForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const shiftDate = document.getElementById('shiftDate').value;
            const shiftType = document.getElementById('shiftType').value;
            const crewName = document.getElementById('crewName').value;
            const holeId = document.getElementById('holeId').value;
            const rigNumber = document.getElementById('rigNumber').value;
            const totalMeters = parseFloat(document.getElementById('totalMeters').value);
            const notes = document.getElementById('notes').value;
            
            // Check if we're editing an existing log
            if (currentEditLogId) {
                // Find the existing log
                const existingLogIndex = logs.findIndex(l => l.id === currentEditLogId);
                if (existingLogIndex !== -1) {
                    // Update the existing log
                    logs[existingLogIndex] = {
                        ...logs[existingLogIndex],
                        date: shiftDate,
                        shift: shiftType,
                        crew: crewName,
                        rig: rigNumber,
                        meters: totalMeters,
                        notes: notes,
                        activities: getActivitiesFromForm()
                    };
                    
                    saveLogs();
                    renderTable();
                    showToast('Log entry updated successfully!', 'success');
                    
                    // Reset edit mode
                    currentEditLogId = null;
                    document.getElementById('formSubmitBtn').innerHTML = '<i class="fas fa-save mr-2"></i> Save Log';
                    showPage('logsPage');
                    return;
                }
            }
            
            // Collect activities
            const activities = [];
            const activityElements = document.querySelectorAll('.activity-item');
            activityElements.forEach(el => {
                activities.push({
                    id: parseInt(el.dataset.id),
                    startTime: el.querySelector('.activity-start-time').textContent,
                    endTime: el.querySelector('.activity-end-time').textContent,
                    type: el.querySelector('.activity-type').textContent,
                    description: el.querySelector('.activity-description').textContent
                });
            });
            
            // Create new log entry
            const newLog = {
                id: Date.now(),
                date: shiftDate,
                shift: shiftType,
                crew: crewName,
                holeId: holeId,
                rig: rigNumber,
                rigType: rigType,
                meters: totalMeters,
                notes: notes,
                activities: getActivitiesFromForm(),
                createdAt: new Date().toISOString()
            };
            
            // Add to logs array and save to localStorage
            logs.unshift(newLog);
            saveLogs();
            
            // Reset form and update UI
            drillingLogForm.reset();
            activityContainer.innerHTML = '';
            document.getElementById('shiftDate').value = shiftDate; // Keep the same date
            renderTable();
            
            // Show success message
            showToast('Log entry saved successfully!', 'success');
            
            // Switch to logs page
            showPage('logsPage');
        });

        // Add activity button click
        addActivityBtn.addEventListener('click', function() {
            activityModal.classList.remove('hidden');
            activityForm.reset();
            // Set start time to last activity's end time
            document.getElementById('activityStartTime').value = lastActivityEndTime;
        });

        // Close modal buttons
        closeModalBtn.addEventListener('click', function() {
            activityModal.classList.add('hidden');
        });

        cancelActivityBtn.addEventListener('click', function() {
            activityModal.classList.add('hidden');
        });

        closeViewModalBtn.addEventListener('click', function() {
            viewLogModal.classList.add('hidden');
        });

        // Track last activity end time
        let lastActivityEndTime = '06:00';

        // Activity form submission
        activityForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const startTime = document.getElementById('activityStartTime').value;
            const endTime = document.getElementById('activityEndTime').value;
            const type = document.getElementById('activityType').value;
            const description = document.getElementById('activityDescription').value;
            
            // Update last end time for next activity
            lastActivityEndTime = endTime;
            
            // Create activity element
            const activityId = currentActivityId++;
            const activityElement = document.createElement('div');
            activityElement.className = 'activity-item bg-slate-800 border border-slate-700 rounded-lg p-4 flex justify-between items-start';
            activityElement.dataset.id = activityId;
            activityElement.innerHTML = `
                <div>
                    <div class="flex items-center mb-1">
                        <span class="activity-type font-medium text-purple-300">${type}</span>
                        <span class="mx-2 text-slate-500">|</span>
                        <span class="activity-start-time text-blue-300">${formatTime(startTime)}</span>
                        <span class="mx-2 text-slate-500">-</span>
                        <span class="activity-end-time text-blue-300">${formatTime(endTime)}</span>
                    </div>
                    <p class="activity-description text-sm text-slate-300">${description}</p>
                </div>
                <button class="delete-activity text-red-400 hover:text-red-500 ml-4" data-id="${activityId}">
                    <i class="fas fa-trash-alt"></i>
                </button>
            `;
            
            // Add to container
            activityContainer.appendChild(activityElement);
            
            // Add event listener to delete button
            activityElement.querySelector('.delete-activity').addEventListener('click', function() {
                activityElement.remove();
            });
            
            // Close modal and reset form
            activityModal.classList.add('hidden');
            activityForm.reset();
        });

        // Delete activity
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-activity') || e.target.closest('.delete-activity')) {
                const button = e.target.classList.contains('delete-activity') ? e.target : e.target.closest('.delete-activity');
                const id = parseInt(button.dataset.id);
                const activityElement = document.querySelector(`.activity-item[data-id="${id}"]`);
                if (activityElement) {
                    activityElement.remove();
                }
            }
        });

        // Filter functionality
        dateFilter.addEventListener('change', function() {
            currentPage = 1;
            renderTable();
        });
        
        rigFilter.addEventListener('change', function() {
            currentPage = 1;
            renderTable();
        });

        // Sortable table headers
        sortableHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const column = this.dataset.column;
                
                if (sortColumn === column) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = column;
                    sortDirection = 'asc';
                }
                
                // Update sort icons
                sortableHeaders.forEach(h => {
                    const icon = h.querySelector('i');
                    if (h.dataset.column === column) {
                        icon.className = sortDirection === 'asc' ? 'fas fa-sort-up ml-1' : 'fas fa-sort-down ml-1';
                    } else {
                        icon.className = 'fas fa-sort ml-1';
                    }
                });
                
                renderTable();
            });
        });

        // Helper function to get activities from form
        function getActivitiesFromForm() {
            const activities = [];
            const activityElements = document.querySelectorAll('.activity-item');
            activityElements.forEach(el => {
                activities.push({
                    id: parseInt(el.dataset.id),
                    startTime: el.querySelector('.activity-start-time').textContent,
                    endTime: el.querySelector('.activity-end-time').textContent,
                    type: el.querySelector('.activity-type').textContent,
                    description: el.querySelector('.activity-description').textContent
                });
            });
            return activities;
        }

        // View/edit log details
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('view-log') || e.target.closest('.view-log')) {
                const button = e.target.classList.contains('view-log') ? e.target : e.target.closest('.view-log');
                const logId = parseInt(button.dataset.id);
                const log = logs.find(l => l.id === logId);
                
                if (log) {
                    showLogDetails(log);
                }
            }
            
            // Edit log
            if (e.target.classList.contains('edit-log') || e.target.closest('.edit-log')) {
                const button = e.target.classList.contains('edit-log') ? e.target : e.target.closest('.edit-log');
                const logId = parseInt(button.dataset.id);
                const log = logs.find(l => l.id === logId);
                
                if (log) {
                    // Set edit mode
                    currentEditLogId = logId;
                    document.getElementById('formSubmitBtn').innerHTML = '<i class="fas fa-save mr-2"></i> Update Log';
                    
                    // Load log data into form
                    document.getElementById('shiftDate').value = log.date;
                    document.getElementById('shiftType').value = log.shift;
                    document.getElementById('crewName').value = log.crew;
                    document.getElementById('holeId').value = log.holeId || '';
                    document.getElementById('rigNumber').value = log.rig;
                    document.getElementById('rigType').value = log.rigType || '';
                    document.getElementById('totalMeters').value = log.meters;
                    document.getElementById('notes').value = log.notes || '';
                    
                    // Clear existing activities
                    activityContainer.innerHTML = '';
                    
                    // Add activities to form
                    log.activities.forEach(activity => {
                        const activityId = currentActivityId++;
                        const activityElement = document.createElement('div');
                        activityElement.className = 'activity-item bg-slate-800 border border-slate-700 rounded-lg p-4 flex justify-between items-start';
                        activityElement.dataset.id = activityId;
                        activityElement.innerHTML = `
                            <div>
                                <div class="flex items-center mb-1">
                                    <span class="activity-type font-medium text-purple-300">${activity.type}</span>
                                    <span class="mx-2 text-slate-500">|</span>
                                    <span class="activity-start-time text-blue-300">${activity.startTime}</span>
                                    <span class="mx-2 text-slate-500">-</span>
                                    <span class="activity-end-time text-blue-300">${activity.endTime}</span>
                                </div>
                                <p class="activity-description text-sm text-slate-300">${activity.description}</p>
                            </div>
                            <button class="delete-activity text-red-400 hover:text-red-500 ml-4" data-id="${activityId}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        `;
                        activityContainer.appendChild(activityElement);
                    });
                    
                    // Switch to form page
                    showPage('formPage');
                }
            }
            
            // Delete log
            if (e.target.classList.contains('delete-log') || e.target.closest('.delete-log')) {
                const button = e.target.classList.contains('delete-log') ? e.target : e.target.closest('.delete-log');
                const logId = parseInt(button.dataset.id);
                
                if (confirm('Are you sure you want to delete this log entry?')) {
                    logs = logs.filter(l => l.id !== logId);
                    saveLogs();
                    renderTable();
                    
                    showToast('Log entry deleted successfully!', 'success');
                }
            }
        });

        // Save logs to localStorage
        function saveLogs() {
            localStorage.setItem('drillingLogs', JSON.stringify(logs));
        }

        // Load logs from localStorage
        function loadLogs() {
            const storedLogs = localStorage.getItem('drillingLogs');
            if (storedLogs) {
                logs = JSON.parse(storedLogs);
            }
        }

        // Render the table with pagination
        function renderTable() {
            // Filter logs based on date filter and rig filter
            let filteredLogs = [...logs];
            const dateFilterValue = dateFilter.value;
            const rigFilterValue = document.getElementById('rigFilter').value;
            
            if (dateFilterValue !== 'all') {
                const now = new Date();
                let startDate;
                
                switch (dateFilterValue) {
                    case 'today':
                        startDate = new Date(now.setHours(0, 0, 0, 0));
                        break;
                    case 'week':
                        const day = now.getDay();
                        const diff = now.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday
                        startDate = new Date(now.setDate(diff));
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                }
                
                filteredLogs = filteredLogs.filter(log => {
                    const logDate = new Date(log.date);
                    return logDate >= startDate;
                });
            }
            
            // Apply rig filter
            if (rigFilterValue !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.rig === rigFilterValue);
            }
            
            // Sort logs
            filteredLogs.sort((a, b) => {
                let aValue, bValue;
                
                switch (sortColumn) {
                    case 'date':
                        aValue = new Date(a.date);
                        bValue = new Date(b.date);
                        break;
                    case 'shift':
                        aValue = a.shift;
                        bValue = b.shift;
                        break;
                    case 'crew':
                        aValue = a.crew;
                        bValue = b.crew;
                        break;
                    case 'rig':
                        aValue = a.rig;
                        bValue = b.rig;
                        break;
                    case 'rigType':
                        aValue = a.rigType;
                        bValue = b.rigType;
                        break;
                    case 'meters':
                        aValue = a.meters;
                        bValue = b.meters;
                        break;
                    default:
                        aValue = new Date(a.createdAt);
                        bValue = new Date(b.createdAt);
                }
                
                if (typeof aValue === 'string' && typeof bValue === 'string') {
                    return sortDirection === 'asc' 
                        ? aValue.localeCompare(bValue)
                        : bValue.localeCompare(aValue);
                } else {
                    return sortDirection === 'asc' 
                        ? (aValue > bValue ? 1 : -1)
                        : (aValue < bValue ? 1 : -1);
                }
            });
            
            // Pagination
            const totalLogs = filteredLogs.length;
            const totalPages = Math.ceil(totalLogs / rowsPerPage);
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = Math.min(startIndex + rowsPerPage, totalLogs);
            const paginatedLogs = filteredLogs.slice(startIndex, endIndex);
            
            // Clear table body
            logTableBody.innerHTML = '';
            
            // Add rows
            if (paginatedLogs.length === 0) {
                const row = document.createElement('tr');
                row.className = 'bg-slate-800';
                row.innerHTML = `
                    <td colspan="7" class="px-6 py-4 text-center text-slate-400">
                        No logs found. Add your first drilling log above!
                    </td>
                `;
                logTableBody.appendChild(row);
            } else {
                paginatedLogs.forEach(log => {
                    const row = document.createElement('tr');
                    row.className = 'group hover:bg-slate-700/50 transition-colors bg-slate-700/90 border-b-2 border-slate-700';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            ${formatDate(log.date)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${getShiftBadgeClass(log.shift)}">
                                ${log.shift}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            ${log.crew}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            ${log.holeId || '-'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            ${log.rig}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            ${log.rigType || '-'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-300">
                            ${log.meters.toFixed(2)} m
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-300">
                            <div class="flex flex-wrap gap-1 max-w-xs">
                                ${log.activities.slice(0, 3).map(activity => `
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-700 text-slate-300">
                                        ${activity.type}
                                    </span>
                                `).join('')}
                                ${log.activities.length > 3 ? `
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-700 text-slate-500">
                                        +${log.activities.length - 3} more
                                    </span>
                                ` : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="view-log text-blue-400 hover:text-blue-300 mr-2" data-id="${log.id}">
                                <i class="fas fa-eye mr-1"></i>
                            </button>
                            <button class="edit-log text-yellow-400 hover:text-yellow-300 mr-2" data-id="${log.id}">
                                <i class="fas fa-edit mr-1"></i>
                            </button>
                            <button class="delete-log text-red-400 hover:text-red-300" data-id="${log.id}">
                                <i class="fas fa-trash-alt mr-1"></i>
                            </button>
                        </td>
                    `;
                    logTableBody.appendChild(row);
                    
                    // Add activity sub-rows
                    log.activities.forEach(activity => {
                        const subRow = document.createElement('tr');
                        subRow.className = 'bg-slate-800/30 group-hover:bg-slate-800/60 transition-colors hover:bg-slate-700/70';
                        subRow.innerHTML = `
                            <td class="px-6 py-2 text-sm text-slate-400">
                                <div class="flex items-center">
                                    <span class="w-2 h-2 rounded-full bg-purple-500 mr-2"></span>
                                    ${activity.type}
                                </div>
                            </td>
                            <td class="px-6 py-2 text-sm text-slate-400">
                                ${activity.startTime}
                            </td>
                            <td class="px-6 py-2 text-sm text-slate-400">
                                ${activity.endTime}
                            </td>
                            <td class="px-6 py-2 text-sm text-slate-400">
                                ${activity.description || 'No description'}
                            </td>
                            <td colspan="2"></td>
                        `;
                        logTableBody.appendChild(subRow);
                    });
                });
            }
            
            // Update pagination info
            document.getElementById('tableInfo').textContent = 
                `Showing ${totalLogs === 0 ? 0 : startIndex + 1} to ${endIndex} of ${totalLogs} entries`;
            
            // Update pagination buttons
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            
            if (totalPages > 1) {
                // Previous button
                const prevButton = document.createElement('button');
                prevButton.className = `px-3 py-1 rounded ${currentPage === 1 ? 'bg-slate-700 text-slate-500 cursor-not-allowed' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`;
                prevButton.textContent = 'Previous';
                prevButton.disabled = currentPage === 1;
                prevButton.addEventListener('click', function() {
                    if (currentPage > 1) {
                        currentPage--;
                        renderTable();
                    }
                });
                paginationElement.appendChild(prevButton);
                
                // Page buttons
                const maxVisiblePages = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                
                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }
                
                if (startPage > 1) {
                    const firstButton = document.createElement('button');
                    firstButton.className = 'px-3 py-1 rounded bg-slate-700 text-slate-300 hover:bg-slate-600';
                    firstButton.textContent = '1';
                    firstButton.addEventListener('click', function() {
                        currentPage = 1;
                        renderTable();
                    });
                    paginationElement.appendChild(firstButton);
                    
                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'px-2 py-1';
                        ellipsis.textContent = '...';
                        paginationElement.appendChild(ellipsis);
                    }
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.className = `px-3 py-1 rounded ${currentPage === i ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`;
                    pageButton.textContent = i;
                    pageButton.addEventListener('click', function() {
                        currentPage = i;
                        renderTable();
                    });
                    paginationElement.appendChild(pageButton);
                }
                
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'px-2 py-1';
                        ellipsis.textContent = '...';
                        paginationElement.appendChild(ellipsis);
                    }
                    
                    const lastButton = document.createElement('button');
                    lastButton.className = 'px-3 py-1 rounded bg-slate-700 text-slate-300 hover:bg-slate-600';
                    lastButton.textContent = totalPages;
                    lastButton.addEventListener('click', function() {
                        currentPage = totalPages;
                        renderTable();
                    });
                    paginationElement.appendChild(lastButton);
                }
                
                // Next button
                const nextButton = document.createElement('button');
                nextButton.className = `px-3 py-1 rounded ${currentPage === totalPages ? 'bg-slate-700 text-slate-500 cursor-not-allowed' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`;
                nextButton.textContent = 'Next';
                nextButton.disabled = currentPage === totalPages;
                nextButton.addEventListener('click', function() {
                    if (currentPage < totalPages) {
                        currentPage++;
                        renderTable();
                    }
                });
                paginationElement.appendChild(nextButton);
            }
        }

        // Show log details in modal
        function showLogDetails(log) {
            const formattedDate = formatDate(log.date);
            const formattedCreatedAt = new Date(log.createdAt).toLocaleString();
            
            let activitiesHtml = '';
            log.activities.forEach(activity => {
                activitiesHtml += `
                    <div class="border-l-2 border-purple-500 pl-4 py-2 mb-3">
                        <div class="flex items-center mb-1">
                            <span class="font-medium text-purple-300">${activity.type}</span>
                            <span class="mx-3 text-slate-500">|</span>
                            <span class="text-blue-300">${activity.startTime}</span>
                            <span class="mx-2 text-slate-500">-</span>
                            <span class="text-blue-300">${activity.endTime}</span>
                            <span class="ml-3 text-xs text-slate-400">
                                (${calculateHours(activity.startTime, activity.endTime)} hrs)
                            </span>
                        </div>
                        <p class="text-sm text-slate-300">${activity.description}</p>
                    </div>
                `;
            });
            
            logDetailsContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h4 class="text-sm font-medium text-slate-400 mb-1">Shift Date</h4>
                        <p class="text-lg text-slate-100">${formattedDate}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-slate-400 mb-1">Shift Type</h4>
                        <span class="px-2 py-1 text-sm rounded-full ${getShiftBadgeClass(log.shift)}">
                            ${log.shift}
                        </span>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-slate-400 mb-1">Crew Name</h4>
                        <p class="text-lg text-slate-100">${log.crew}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-slate-400 mb-1">Rig Number</h4>
                        <p class="text-lg text-slate-100">${log.rig}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-slate-400 mb-1">Meters Drilled</h4>
                        <p class="text-lg text-blue-300">${log.meters.toFixed(2)} m</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-slate-400 mb-1">Recorded On</h4>
                        <p class="text-sm text-slate-300">${formattedCreatedAt}</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-slate-400 mb-1">Notes</h4>
                    <p class="text-slate-300 whitespace-pre-line">${log.notes || 'No notes recorded'}</p>
                </div>
                
                <div>
                    <h4 class="text-sm font-medium text-slate-400 mb-2">Activities</h4>
                    ${activitiesHtml || '<p class="text-slate-400">No activities recorded</p>'}
                </div>
            `;
            
            viewLogModal.classList.remove('hidden');
        }

        // Helper functions
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            let hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12;
            hour = hour ? hour : 12; // the hour '0' should be '12'
            return `${hour}:${minutes} ${ampm}`;
        }

        function calculateHours(startTime, endTime) {
            if (!startTime || !endTime) return 0;
            
            const [startH, startM] = startTime.split(':').map(Number);
            const [endH, endM] = endTime.split(':').map(Number);
            
            const startTotal = startH + (startM / 60);
            const endTotal = endH + (endM / 60);
            
            let hours = endTotal - startTotal;
            if (hours < 0) hours += 24; // Handle overnight shifts
            
            return hours.toFixed(1);
        }

        function getShiftBadgeClass(shift) {
            switch (shift) {
                case 'Day': return 'bg-blue-500/20 text-blue-300';
                case 'Night': return 'bg-purple-500/20 text-purple-300';
                
                default: return 'bg-slate-500/20 text-slate-300';
            }
        }

        // Dashboard chart functions
        let metersChart = null;
        let rigsChart = null;

        function renderDashboardCharts() {
            const dateFilter = document.getElementById('dashboardDateFilter').value;
            const rigFilter = document.getElementById('dashboardRigFilter').value;
            const shiftFilter = document.getElementById('dashboardShiftFilter').value;
            
            // Filter logs based on dashboard filters
            let filteredLogs = [...logs];
            
            // Apply date filter
            const now = new Date();
            let startDate;
            
            switch (dateFilter) {
                case 'week':
                    startDate = new Date(now.setDate(now.getDate() - 7));
                    break;
                case 'month':
                    startDate = new Date(now.setMonth(now.getMonth() - 1));
                    break;
                case 'quarter':
                    startDate = new Date(now.setMonth(now.getMonth() - 3));
                    break;
                case 'all':
                    startDate = new Date(0); // Beginning of time
                    break;
            }
            
            filteredLogs = filteredLogs.filter(log => new Date(log.date) >= startDate);
            
            // Apply rig filter
            if (rigFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.rig === rigFilter);
            }
            
            // Apply shift filter
            if (shiftFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.shift === shiftFilter);
            }
            
            // Group data by date for meters chart
            const dateGroups = {};
            filteredLogs.forEach(log => {
                const date = log.date;
                if (!dateGroups[date]) {
                    dateGroups[date] = 0;
                }
                dateGroups[date] += log.meters;
            });
            
            // Prepare data for rigs chart
            const rigGroups = {};
            filteredLogs.forEach(log => {
                const rig = log.rig;
                if (!rigGroups[rig]) {
                    rigGroups[rig] = 0;
                }
                rigGroups[rig] += log.meters;
            });
            
            // Render meters chart
            const metersCtx = document.getElementById('metersChart').getContext('2d');
            const dates = Object.keys(dateGroups).sort();
            const metersData = dates.map(date => dateGroups[date]);
            
            if (metersChart) {
                metersChart.destroy();
            }
            
            metersChart = new Chart(metersCtx, {
                type: 'bar',
                data: {
                    labels: dates.map(date => formatDate(date)),
                    datasets: [{
                        label: 'Meters Drilled',
                        data: metersData,
                        backgroundColor: 'rgba(96, 165, 250, 0.7)',
                        borderColor: 'rgba(96, 165, 250, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                font: {
                                    size: 12
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            });
            
            // Render rigs line chart
            const rigsCtx = document.getElementById('rigsChart').getContext('2d');
            
            // Group data by rig and date
            const rigDataByDate = {};
            filteredLogs.forEach(log => {
                if (!rigDataByDate[log.rig]) {
                    rigDataByDate[log.rig] = {};
                }
                rigDataByDate[log.rig][log.date] = (rigDataByDate[log.rig][log.date] || 0) + log.meters;
            });
            
            // Get all unique dates
            const allDates = [...new Set(filteredLogs.map(log => log.date))].sort();
            
            // Prepare datasets for each rig
            const rigDatasets = [];
            const rigColors = [
                'rgba(255, 99, 132, 1)',     // Red
                'rgba(54, 162, 235, 1)',     // Blue
                'rgba(255, 206, 86, 1)',     // Yellow
                'rgba(75, 192, 192, 1)',     // Teal
                'rgba(153, 102, 255, 1)',    // Purple
                'rgba(255, 159, 64, 1)',     // Orange
                'rgba(0, 204, 102, 1)',      // Green
                'rgba(199, 0, 57, 1)'        // Dark Red
            ];
            
            Object.keys(rigDataByDate).forEach((rig, index) => {
                const data = allDates.map(date => rigDataByDate[rig][date] || 0);
                rigDatasets.push({
                    label: rig,
                    data: data,
                    borderColor: rigColors[index % rigColors.length],
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    borderWidth: 2,
                    tension: 0.1,
                    fill: false
                });
            });
            
            if (rigsChart) {
                rigsChart.destroy();
            }
            
            rigsChart = new Chart(rigsCtx, {
                type: 'line',
                data: {
                    labels: allDates.map(date => formatDate(date)),
                    datasets: rigDatasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                font: {
                                    size: 12
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            });
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg flex items-center ${
                type === 'success' ? 'bg-green-600' : 'bg-red-600'
            } text-white`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                ${message}
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
