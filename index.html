<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borehole Schematic Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }
        
        .input-field:focus {
            border-color: #818cf8;
            box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.1);
        }
        
        .borehole-container, .depth-scale, .geology-left, .geology-right, 
        .bore-construction, .annulus-construction, .water-level {
            position: absolute;
        }
        
        .borehole-container {
            margin-left: 40px;
            width: calc(100% - 40px);
        }
        
        .depth-scale {
            left: -40px;
            width: 40px;
            border-right: 1px solid #e5e7eb;
            background-color: #f9fafb;
        }
        
        .depth-marker {
            position: absolute;
            right: 4px;
            font-size: 0.65rem;
            color: #555;
        }
        
        .geology-left {
            left: 0;
            width: calc(50% - 60px);
            background-color: #f9fafb;
        }
        
        .geology-right {
            right: 0;
            width: calc(50% - 60px);
            background-color: #f9fafb;
        }
        
        .bore-construction {
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            z-index: 2;
        }
        
        .annulus-construction {
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            z-index: 1;
        }
        
        .water-level {
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            z-index: 4;
        }
        
        .layer-segment {
            position: relative;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .segment-label, .water-level-label, .right-label, .annulus-label {
            position: absolute;
            font-size: 0.6rem;
            white-space: nowrap;
        }
        
        .segment-label {
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            font-weight: 500;
        }
        
        .water-level-label {
            left: 50%;
            transform: translateX(-50%);
            color: #0077FF;
            text-shadow: 1px 1px 1px rgba(255,255,255,0.5);
            background-color: rgba(255,255,255,0.7);
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .right-label {
            right: -100px;
            color: #555;
            width: 90px;
            background: white;
            padding: 4px 6px;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 500;
        }
        
        .annulus-label {
            left: -90px;
            color: #555;
            width: 80px;
            text-align: right;
            background-color: white;
            padding: 4px 6px;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 500;
        }
        
        .color-preview {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            display: inline-block;
            margin-right: 6px;
            vertical-align: middle;
            border: 1px solid #e2e8f0;
        }
        
        .ground-level {
            position: absolute;
            left: 0;
            right: 0;
            border-top: 2px dashed #6366f1;
            z-index: 10;
        }
        
        .ground-level-label {
            position: absolute;
            left: -40px;
            font-size: 0.6rem;
            color: #6366f1;
            background-color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .export-spinner {
            display: none;
            margin-left: 6px;
        }

        .exporting .export-spinner {
            display: inline-block;
        }

        .exporting .export-text {
            display: none;
        }
        
        /* Compact form styles */
        .compact-form .form-group {
            margin-bottom: 0.5rem;
        }
        
        .compact-form label {
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            display: block;
        }
        
        .compact-form input, .compact-form select {
            padding: 0.35rem 0.5rem;
            font-size: 0.8rem;
        }
        
        .compact-form .btn {
            padding: 0.35rem 0.75rem;
            font-size: 0.8rem;
        }
        
        /* Compact list styles */
        .compact-list {
            max-height: 120px;
            overflow-y: auto;
            font-size: 0.8rem;
        }
        
        .compact-list-item {
            padding: 0.4rem 0.75rem;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .compact-list-item:hover {
            background-color: #f8fafc;
        }
        
        /* Tab navigation */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab-btn {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }
        
        .tab-btn.active {
            border-bottom-color: #6366f1;
            color: #6366f1;
            font-weight: 500;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .borehole-container {
                margin-left: 30px;
                width: calc(100% - 30px);
            }
            
            .depth-scale {
                left: -30px;
                width: 30px;
            }
            
            .geology-left, .geology-right {
                width: calc(50% - 45px);
            }
            
            .bore-construction {
                width: 30px;
            }
            
            .annulus-construction {
                width: 60px;
            }
            
            .water-level {
                width: 30px;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 py-4 px-4 shadow-sm">
        <div class="container mx-auto">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold text-white">Borehole Schematic Generator</h1>
                    <p class="text-indigo-100 text-xs">Create and export borehole diagrams</p>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="bg-white/20 rounded-full p-1">
                        <i class="fas fa-water text-white text-sm"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-4">
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-4">
            <!-- Left Panel - Forms -->
            <div class="lg:col-span-2 space-y-4">
                <!-- Borehole Details -->
                <div class="card p-4">
                    <div class="flex items-center mb-3">
                        <div class="bg-indigo-100 p-1 rounded-lg mr-3">
                            <i class="fas fa-info-circle text-indigo-600 text-sm"></i>
                        </div>
                        <h2 class="text-base font-semibold text-gray-800">Borehole Details</h2>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="form-group">
                            <label for="boreId" class="text-xs text-gray-600">Bore ID</label>
                            <input type="text" id="boreId" class="input-field w-full px-3 py-1 text-sm rounded-md shadow-sm focus:outline-none" placeholder="BH-001">
                        </div>
                        <div class="form-group">
                            <label for="totalHoleDepth" class="text-xs text-gray-600">Total Depth (m)</label>
                            <input type="number" id="totalHoleDepth" step="0.5" min="0" value="30" class="input-field w-full px-3 py-1 text-sm rounded-md shadow-sm focus:outline-none" required>
                        </div>
                        <div class="form-group">
                            <label for="waterDepth" class="text-xs text-gray-600">Water Depth (m)</label>
                            <input type="number" id="waterDepth" step="0.5" min="0" class="input-field w-full px-3 py-1 text-sm rounded-md shadow-sm focus:outline-none">
                        </div>
                        <div class="form-group flex items-end">
                            <button id="generateBtn" class="btn-primary w-full py-1 px-3 rounded-md text-sm">
                                <i class="fas fa-sync-alt mr-1"></i> Update
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="layers">
                            <i class="fas fa-layer-group mr-1"></i> Layers
                        </button>
                        <button class="tab-btn" data-tab="construction">
                            <i class="fas fa-hammer mr-1"></i> Construction
                        </button>
                        <button class="tab-btn" data-tab="annulus">
                            <i class="fas fa-fill-drip mr-1"></i> Annulus
                        </button>
                    </div>
                    
                    <!-- Layers Tab -->
                    <div class="tab-content p-4" id="layers-tab">
                        <form id="layerForm" class="compact-form space-y-2">
                            <div class="grid grid-cols-3 gap-2">
                                <div class="form-group">
                                    <label for="fromDepth">From (m)</label>
                                    <input type="number" id="fromDepth" step="0.5" class="input-field w-full" required>
                                </div>
                                <div class="form-group">
                                    <label for="toDepth">To (m)</label>
                                    <input type="number" id="toDepth" step="0.5" class="input-field w-full" required>
                                </div>
                                <div class="form-group">
                                    <label for="materialType">Material</label>
                                    <select id="materialType" class="input-field w-full" required>
                                        <option value="" disabled selected>Select</option>
                                        <option value="Detritals" data-color="#FF5733">Detritals</option>
                                        <option value="Pisolites" data-color="#33FF57">Pisolites</option>
                                        <option value="Calcrete" data-color="#3357FF">Calcrete</option>
                                        <option value="Clay" data-color="#F0FF33">Clay</option>
                                        <option value="Sandstone" data-color="#FFC300">Sandstone</option>
                                        <option value="Limestone" data-color="#50C878">Limestone</option>
                                        <option value="Granite" data-color="#C0C0C0">Granite</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex space-x-2 pt-1">
                                <button type="submit" class="btn-primary flex-1 py-1 px-2 rounded-md text-xs">
                                    <i class="fas fa-plus mr-1"></i> Add Layer
                                </button>
                                <button type="button" id="clearAllLayers" class="bg-gray-100 text-gray-700 py-1 px-2 rounded-md text-xs border border-gray-200 hover:bg-gray-50">
                                    <i class="fas fa-trash-alt mr-1"></i> Clear
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-3">
                            <h3 class="text-xs font-medium text-gray-700 mb-1 flex items-center">
                                <i class="fas fa-list-ul mr-1 text-gray-400"></i> Current Layers
                            </h3>
                            <div id="layerList" class="compact-list border rounded-md">
                                <div class="empty-state p-2 text-center text-gray-400 text-xs">
                                    <i class="fas fa-layer-group text-lg mb-1 text-gray-300"></i>
                                    <p>No layers added</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Construction Tab -->
                    <div class="tab-content p-4 hidden" id="construction-tab">
                        <form id="constructionForm" class="compact-form space-y-2">
                            <div class="grid grid-cols-3 gap-2">
                                <div class="form-group">
                                    <label for="constructionFromDepth">From (m)</label>
                                    <input type="number" id="constructionFromDepth" step="0.5" class="input-field w-full" required>
                                </div>
                                <div class="form-group">
                                    <label for="constructionToDepth">To (m)</label>
                                    <input type="number" id="constructionToDepth" step="0.5" class="input-field w-full" required>
                                </div>
                                <div class="form-group">
                                    <label for="constructionType">Type</label>
                                    <select id="constructionType" class="input-field w-full" required>
                                        <option value="" disabled selected>Select</option>
                                        <option value="Headworks" data-color="#8B4513">Headworks</option>
                                        <option value="Surface Casing" data-color="#A0522D">Surface Casing</option>
                                        <option value="Blank Casing" data-color="#CD853F">Blank Casing</option>
                                        <option value="Slotted Casing" data-color="#D2691E">Slotted Casing</option>
                                        <option value="Screen" data-color="#B87333">Screen</option>
                                        <option value="Riser Pipe" data-color="#6E260E">Riser Pipe</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex space-x-2 pt-1">
                                <button type="submit" class="btn-primary flex-1 py-1 px-2 rounded-md text-xs">
                                    <i class="fas fa-plus mr-1"></i> Add Construction
                                </button>
                                <button type="button" id="clearAllConstruction" class="bg-gray-100 text-gray-700 py-1 px-2 rounded-md text-xs border border-gray-200 hover:bg-gray-50">
                                    <i class="fas fa-trash-alt mr-1"></i> Clear
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-3">
                            <h3 class="text-xs font-medium text-gray-700 mb-1 flex items-center">
                                <i class="fas fa-list-ul mr-1 text-gray-400"></i> Current Construction
                            </h3>
                            <div id="constructionList" class="compact-list border rounded-md">
                                <div class="empty-state p-2 text-center text-gray-400 text-xs">
                                    <i class="fas fa-hammer text-lg mb-1 text-gray-300"></i>
                                    <p>No construction added</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Annulus Tab -->
                    <div class="tab-content p-4 hidden" id="annulus-tab">
                        <form id="annulusForm" class="compact-form space-y-2">
                            <div class="grid grid-cols-3 gap-2">
                                <div class="form-group">
                                    <label for="annulusFromDepth">From (m)</label>
                                    <input type="number" id="annulusFromDepth" step="0.5" min="0" class="input-field w-full" required>
                                </div>
                                <div class="form-group">
                                    <label for="annulusToDepth">To (m)</label>
                                    <input type="number" id="annulusToDepth" step="0.5" min="0" class="input-field w-full" required>
                                </div>
                                <div class="form-group">
                                    <label for="annulusType">Type</label>
                                    <select id="annulusType" class="input-field w-full" required>
                                        <option value="" disabled selected>Select</option>
                                        <option value="Grout" data-color="#6B7280">Grout</option>
                                        <option value="Gravel" data-color="#92400E">Gravel</option>
                                        <option value="Bentonite" data-color="#3F6212">Bentonite</option>
                                        <option value="Cement" data-color="#9CA3AF">Cement</option>
                                        <option value="Sand" data-color="#D97706">Sand</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex space-x-2 pt-1">
                                <button type="submit" class="btn-primary flex-1 py-1 px-2 rounded-md text-xs">
                                    <i class="fas fa-plus mr-1"></i> Add Annulus
                                </button>
                                <button type="button" id="clearAllAnnulus" class="bg-gray-100 text-gray-700 py-1 px-2 rounded-md text-xs border border-gray-200 hover:bg-gray-50">
                                    <i class="fas fa-trash-alt mr-1"></i> Clear
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-3">
                            <h3 class="text-xs font-medium text-gray-700 mb-1 flex items-center">
                                <i class="fas fa-list-ul mr-1 text-gray-400"></i> Current Annulus
                            </h3>
                            <div id="annulusList" class="compact-list border rounded-md">
                                <div class="empty-state p-2 text-center text-gray-400 text-xs">
                                    <i class="fas fa-fill-drip text-lg mb-1 text-gray-300"></i>
                                    <p>No annulus added</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Borehole Visualization -->
            <div class="lg:col-span-3">
                <div class="card p-4 h-full flex flex-col">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center">
                            <div class="bg-indigo-100 p-1 rounded-lg mr-3">
                                <i class="fas fa-chart-bar text-indigo-600 text-sm"></i>
                            </div>
                            <h2 class="text-base font-semibold text-gray-800">Borehole Schematic</h2>
                        </div>
                        <div class="flex space-x-1">
                            <button id="zoomIn" class="bg-gray-100 p-1 rounded-md text-gray-700 hover:bg-gray-200">
                                <i class="fas fa-search-plus text-xs"></i>
                            </button>
                            <button id="zoomOut" class="bg-gray-100 p-1 rounded-md text-gray-700 hover:bg-gray-200">
                                <i class="fas fa-search-minus text-xs"></i>
                            </button>
                            <button id="exportBtn" class="btn-primary py-1 px-3 rounded-md text-xs">
                                <span class="export-text"><i class="fas fa-download mr-1"></i> Export</span>
                                <span class="export-spinner"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-3 bg-gray-50 shadow-inner flex-grow overflow-auto">
                        <div id="boreholeWrapper" class="relative" style="min-height: 100%;">
                            <div id="boreholeContainer" class="borehole-container">
                                <!-- Depth scale on the left -->
                                <div id="depthScale" class="depth-scale"></div>
                                
                                <!-- Geology on the left -->
                                <div id="geologyLeft" class="geology-left"></div>
                                
                                <!-- Annulus construction (wider than bore construction) -->
                                <div id="annulusConstruction" class="annulus-construction"></div>
                                
                                <!-- Bore construction in the center -->
                                <div id="boreConstruction" class="bore-construction"></div>
                                
                                <!-- Water level -->
                                <div id="waterLevel" class="water-level"></div>
                                
                                <!-- Geology on the right -->
                                <div id="geologyRight" class="geology-right"></div>
                                
                                <!-- Ground level indicator -->
                                <div id="groundLevel" class="ground-level"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-2 flex justify-between items-center text-xs text-gray-500">
                        <div>
                            <span id="totalDepth">Total depth: 30 m</span>
                            <span id="waterDepthDisplay" class="ml-3 hidden"><i class="fas fa-tint text-blue-500"></i> Water at: <span class="font-medium">0</span> m</span>
                        </div>
                        <div>
                            <button id="editModeBtn" class="text-indigo-600 hover:text-indigo-800">
                                <i class="fas fa-edit mr-1"></i> Edit Mode
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const layerForm = document.getElementById('layerForm');
            const totalHoleDepthInput = document.getElementById('totalHoleDepth');
            const waterDepthInput = document.getElementById('waterDepth');
            const fromDepthInput = document.getElementById('fromDepth');
            const toDepthInput = document.getElementById('toDepth');
            const materialTypeSelect = document.getElementById('materialType');
            const clearAllLayersBtn = document.getElementById('clearAllLayers');
            const layerList = document.getElementById('layerList');
            
            const constructionForm = document.getElementById('constructionForm');
            const constructionTypeSelect = document.getElementById('constructionType');
            const constructionFromDepthInput = document.getElementById('constructionFromDepth');
            const constructionToDepthInput = document.getElementById('constructionToDepth');
            const clearAllConstructionBtn = document.getElementById('clearAllConstruction');
            const constructionList = document.getElementById('constructionList');
            
            const annulusForm = document.getElementById('annulusForm');
            const annulusTypeSelect = document.getElementById('annulusType');
            const annulusFromDepthInput = document.getElementById('annulusFromDepth');
            const annulusToDepthInput = document.getElementById('annulusToDepth');
            const clearAllAnnulusBtn = document.getElementById('clearAllAnnulus');
            const annulusList = document.getElementById('annulusList');
            
            const boreholeContainer = document.getElementById('boreholeContainer');
            const boreholeWrapper = document.getElementById('boreholeWrapper');
            const geologyLeft = document.getElementById('geologyLeft');
            const annulusConstruction = document.getElementById('annulusConstruction');
            const boreConstruction = document.getElementById('boreConstruction');
            const waterLevel = document.getElementById('waterLevel');
            const geologyRight = document.getElementById('geologyRight');
            const depthScale = document.getElementById('depthScale');
            const groundLevel = document.getElementById('groundLevel');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const exportBtn = document.getElementById('exportBtn');
            const editModeBtn = document.getElementById('editModeBtn');
            const totalDepthSpan = document.getElementById('totalDepth');
            const waterDepthDisplay = document.getElementById('waterDepthDisplay');
            const boreIdInput = document.getElementById('boreId');
            const generateBtn = document.getElementById('generateBtn');
            
            // Tab navigation elements
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // State
            let layers = [];
            let constructionElements = [];
            let annulusElements = [];
            let segmentHeight = 8; // Smaller default segment height for compact view
            let isEditMode = false;
            let totalHoleDepth = parseFloat(totalHoleDepthInput.value);
            let waterDepth = null;
            let boreId = '';
            
            // Initialize form fields
            fromDepthInput.value = '0';
            constructionFromDepthInput.value = '0';
            annulusFromDepthInput.value = '0';
            
            // Tab navigation
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Update active tab button
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding tab content
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.remove('hidden');
                        }
                    });
                });
            });
            
            // Event listeners for total depth and water depth changes
            generateBtn.addEventListener('click', function() {
                totalHoleDepth = parseFloat(totalHoleDepthInput.value);
                if (isNaN(totalHoleDepth) || totalHoleDepth <= 0) {
                    totalHoleDepth = 30;
                    totalHoleDepthInput.value = 30;
                }
                
                waterDepth = waterDepthInput.value === '' ? null : parseFloat(waterDepthInput.value);
                
                if (waterDepth !== null) {
                    waterDepthDisplay.querySelector('span').textContent = waterDepth;
                    waterDepthDisplay.classList.remove('hidden');
                } else {
                    waterDepthDisplay.classList.add('hidden');
                }
                
                totalDepthSpan.textContent = `Total depth: ${totalHoleDepth} m`;
                generateBorehole();
                
                // Show success animation
                this.innerHTML = '<i class="fas fa-check mr-1"></i> Updated!';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-sync-alt mr-1"></i> Update';
                }, 1500);
            });
            
            // Form submissions
            layerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fromDepth = parseFloat(fromDepthInput.value);
                const toDepth = parseFloat(toDepthInput.value);
                const materialType = materialTypeSelect.value;
                const selectedOption = materialTypeSelect.options[materialTypeSelect.selectedIndex];
                const color = selectedOption.dataset.color;
                
                if (validateDepthInputs(fromDepth, toDepth, totalHoleDepth)) {
                    layers.push({
                        id: Date.now(),
                        fromDepth,
                        toDepth,
                        materialType,
                        color
                    });
                    
                    updateLayerList();
                    generateBorehole();
                    
                    // Reset form
                    fromDepthInput.value = toDepth;
                    toDepthInput.value = '';
                    materialTypeSelect.selectedIndex = 0;
                    
                    // Show success animation
                    const addBtn = layerForm.querySelector('button[type="submit"]');
                    addBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Added!';
                    setTimeout(() => {
                        addBtn.innerHTML = '<i class="fas fa-plus mr-1"></i> Add Layer';
                    }, 1000);
                }
            });
            
            constructionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fromDepth = parseFloat(constructionFromDepthInput.value);
                const toDepth = parseFloat(constructionToDepthInput.value);
                const constructionType = constructionTypeSelect.value;
                const selectedOption = constructionTypeSelect.options[constructionTypeSelect.selectedIndex];
                const color = selectedOption.dataset.color;
                
                if (validateDepthInputs(fromDepth, toDepth, totalHoleDepth)) {
                   constructionElements.push({
  id: Date.now(),
  fromDepth,
  toDepth,
  constructionType,
  color
});
                    
                    updateConstructionList();
                    generateBorehole();
                    
                    // Reset form
                    constructionFromDepthInput.value = toDepth;
                    constructionToDepthInput.value = '';
                    constructionTypeSelect.selectedIndex = 0;
                    
                    // Show success animation
                    const addBtn = constructionForm.querySelector('button[type="submit"]');
                    addBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Added!';
                    setTimeout(() => {
                        addBtn.innerHTML = '<i class="fas fa-plus mr-1"></i> Add Construction';
                    }, 1000);
                }
            });
            
            annulusForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fromDepth = parseFloat(annulusFromDepthInput.value);
                const toDepth = parseFloat(annulusToDepthInput.value);
                const annulusType = annulusTypeSelect.value;
                const selectedOption = annulusTypeSelect.options[annulusTypeSelect.selectedIndex];
                const color = selectedOption.dataset.color;
                
                if (validateDepthInputs(fromDepth, toDepth, totalHoleDepth)) {
                    annulusElements.push({
                        id: Date.now(),
                        fromDepth,
                        toDepth,
                        annulusType,
                        color
                    });
                    
                    updateAnnulusList();
                    generateBorehole();
                    
                    // Reset form
                    annulusFromDepthInput.value = toDepth;
                    annulusToDepthInput.value = '';
                    annulusTypeSelect.selectedIndex = 0;
                    
                    // Show success animation
                    const addBtn = annulusForm.querySelector('button[type="submit"]');
                    addBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Added!';
                    setTimeout(() => {
                        addBtn.innerHTML = '<i class="fas fa-plus mr-1"></i> Add Annulus';
                    }, 1000);
                }
            });
            
            // Clear buttons
            clearAllLayersBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all layers?')) {
                    layers = [];
                    updateLayerList();
                    generateBorehole();
                    fromDepthInput.value = '0';
                    toDepthInput.value = '';
                    
                    // Show cleared animation
                    this.innerHTML = '<i class="fas fa-check mr-1"></i> Cleared!';
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-trash-alt mr-1"></i> Clear';
                    }, 1000);
                }
            });
            
            clearAllConstructionBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all construction elements?')) {
                    constructionElements = [];
                    updateConstructionList();
                    generateBorehole();
                    constructionFromDepthInput.value = '0';
                    constructionToDepthInput.value = '';
                    
                    // Show cleared animation
                    this.innerHTML = '<i class="fas fa-check mr-1"></i> Cleared!';
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-trash-alt mr-1"></i> Clear';
                    }, 1000);
                }
            });
            
            clearAllAnnulusBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all annulus elements?')) {
                    annulusElements = [];
                    updateAnnulusList();
                    generateBorehole();
                    annulusFromDepthInput.value = '0';
                    annulusToDepthInput.value = '';
                    
                    // Show cleared animation
                    this.innerHTML = '<i class="fas fa-check mr-1"></i> Cleared!';
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-trash-alt mr-1"></i> Clear';
                    }, 1000);
                }
            });
            
            // Zoom controls
            zoomInBtn.addEventListener('click', function() {
                if (segmentHeight < 15) {
                    segmentHeight += 1;
                    generateBorehole();
                    
                    // Show zoom animation
                    this.classList.add('text-indigo-800');
                    setTimeout(() => {
                        this.classList.remove('text-indigo-800');
                    }, 300);
                }
            });
            
            zoomOutBtn.addEventListener('click', function() {
                if (segmentHeight > 4) {
                    segmentHeight -= 1;
                    generateBorehole();
                    
                    // Show zoom animation
                    this.classList.add('text-indigo-800');
                    setTimeout(() => {
                        this.classList.remove('text-indigo-800');
                    }, 300);
                }
            });
            
            // Edit mode toggle
            editModeBtn.addEventListener('click', function() {
                isEditMode = !isEditMode;
                editModeBtn.innerHTML = isEditMode 
                    ? '<i class="fas fa-check mr-1"></i> Save Changes' 
                    : '<i class="fas fa-edit mr-1"></i> Edit Mode';
                
                if (!isEditMode) {
                    saveEditChanges();
                }
                
                updateLayerList();
                updateConstructionList();
                updateAnnulusList();
            });
            
            // Export functionality
            exportBtn.addEventListener('click', function() {
                exportToPDF();
            });
            
            // Helper functions
            function validateDepthInputs(fromDepth, toDepth, maxDepth) {
                if (isNaN(fromDepth) || isNaN(toDepth)) {
                    showAlert('Please enter valid depth values', 'error');
                    return false;
                }
                
                if (fromDepth >= toDepth) {
                    showAlert('"From Depth" must be less than "To Depth"', 'error');
                    return false;
                }
                
                if (toDepth > maxDepth) {
                    showAlert('"To Depth" cannot exceed the Total Hole Depth', 'error');
                    return false;
                }
                
                return true;
            }
            
            function showAlert(message, type) {
                const alert = document.createElement('div');
                alert.className = `fixed top-4 right-4 p-3 rounded-lg shadow-lg text-white text-sm ${
                    type === 'error' ? 'bg-red-500' : 'bg-green-500'
                }`;
                alert.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'} mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    alert.classList.add('opacity-0');
                    setTimeout(() => {
                        alert.remove();
                    }, 300);
                }, 3000);
            }
            
            function saveEditChanges() {
                document.querySelectorAll('.layer-edit-input, .construction-edit-input, .annulus-edit-input').forEach(input => {
                    const id = parseInt(input.dataset.id);
                    const property = input.dataset.property;
                    const value = input.value;
                    
                    // Update layers
                    const layer = layers.find(l => l.id === id);
                    if (layer) {
                        layer[property] = property.includes('Depth') ? parseFloat(value) : value;
                        
                        // Update color if material type changed
                        if (property === 'materialType') {
                            const selectedOption = Array.from(materialTypeSelect.options).find(opt => opt.value === value);
                            if (selectedOption && selectedOption.dataset.color) {
                                layer.color = selectedOption.dataset.color;
                            }
                        }
                    }
                    
                    // Update construction elements
                    const construction = constructionElements.find(c => c.id === id);
                    if (construction) {
                        construction[property] = property.includes('Depth') ? parseFloat(value) : value;
                        
                        // Update color if construction type changed
                        if (property === 'constructionType') {
                            const selectedOption = Array.from(constructionTypeSelect.options).find(opt => opt.value === value);
                            if (selectedOption && selectedOption.dataset.color) {
                                construction.color = selectedOption.dataset.color;
                            }
                        }
                    }
                    
                    // Update annulus elements
                    const annulus = annulusElements.find(a => a.id === id);
                    if (annulus) {
                        annulus[property] = property.includes('Depth') ? parseFloat(value) : value;
                        
                        // Update color if annulus type changed
                        if (property === 'annulusType') {
                            const selectedOption = Array.from(annulusTypeSelect.options).find(opt => opt.value === value);
                            if (selectedOption && selectedOption.dataset.color) {
                                annulus.color = selectedOption.dataset.color;
                            }
                        }
                    }
                });
                
                generateBorehole();
                showAlert('Changes saved successfully', 'success');
            }
            
            function updateLayerList() {
                if (layers.length === 0) {
                    layerList.innerHTML = `
                        <div class="empty-state p-2 text-center text-gray-400 text-xs">
                            <i class="fas fa-layer-group text-lg mb-1 text-gray-300"></i>
                            <p>No layers added</p>
                        </div>
                    `;
                    return;
                }
                
                const sortedLayers = [...layers].sort((a, b) => a.fromDepth - b.fromDepth);
                layerList.innerHTML = '';
                
                sortedLayers.forEach(layer => {
                    const layerElement = document.createElement('div');
                    layerElement.className = 'compact-list-item hover:bg-gray-50 group';
                    layerElement.dataset.id = layer.id;
                    
                    if (isEditMode) {
                        layerElement.innerHTML = `
                            <div class="grid grid-cols-4 gap-1 items-center">
                                <div>
                                    <input type="number" step="0.5" value="${layer.fromDepth}" 
                                           data-id="${layer.id}" data-property="fromDepth"
                                           class="layer-edit-input w-full text-xs border rounded p-1">
                                </div>
                                <div>
                                    <input type="number" step="0.5" value="${layer.toDepth}" 
                                           data-id="${layer.id}" data-property="toDepth"
                                           class="layer-edit-input w-full text-xs border rounded p-1">
                                </div>
                                <div>
                                    <select data-id="${layer.id}" data-property="materialType"
                                            class="layer-edit-input w-full text-xs border rounded p-1">
                                        ${Array.from(materialTypeSelect.options).map(option => 
                                            `<option value="${option.value}" ${option.value === layer.materialType ? 'selected' : ''}
                                             ${option.dataset.color ? `data-color="${option.dataset.color}"` : ''}>
                                                ${option.text}
                                            </option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="flex justify-end">
                                    <button class="delete-layer text-red-500 hover:text-red-700 text-xs" data-id="${layer.id}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        layerElement.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div class="flex items-center truncate">
                                    <div class="color-preview mr-2" style="background-color: ${layer.color};"></div>
                                    <div class="truncate">
                                        <div class="font-medium truncate">${layer.materialType}</div>
                                        <div class="text-xs text-gray-500">${layer.fromDepth}m - ${layer.toDepth}m</div>
                                    </div>
                                </div>
                                <button class="delete-layer opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 text-xs" data-id="${layer.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        `;
                    }
                    
                    layerList.appendChild(layerElement);
                });
                
                // Add delete event listeners
                document.querySelectorAll('.delete-layer').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        layers = layers.filter(layer => layer.id !== id);
                        updateLayerList();
                        generateBorehole();
                        showAlert('Layer removed', 'success');
                    });
                });
            }
            
            function updateConstructionList() {
                if (constructionElements.length === 0) {
                    constructionList.innerHTML = `
                        <div class="empty-state p-2 text-center text-gray-400 text-xs">
                            <i class="fas fa-hammer text-lg mb-1 text-gray-300"></i>
                            <p>No construction added</p>
                        </div>
                    `;
                    return;
                }
                
                const sortedConstruction = [...constructionElements].sort((a, b) => a.fromDepth - b.fromDepth);
                constructionList.innerHTML = '';
                
                sortedConstruction.forEach(construction => {
                    const constructionElement = document.createElement('div');
                    constructionElement.className = 'compact-list-item hover:bg-gray-50 group';
                    constructionElement.dataset.id = construction.id;
                    
                    if (isEditMode) {
                        constructionElement.innerHTML = `
                            <div class="grid grid-cols-4 gap-1 items-center">
                                <div>
                                    <input type="number" step="0.5" value="${construction.fromDepth}" 
                                           data-id="${construction.id}" data-property="fromDepth"
                                           class="construction-edit-input w-full text-xs border rounded p-1">
                                </div>
                                <div>
                                    <input type="number" step="0.5" value="${construction.toDepth}" 
                                           data-id="${construction.id}" data-property="toDepth"
                                           class="construction-edit-input w-full text-xs border rounded p-1">
                                </div>
                                <div>
                                    <select data-id="${construction.id}" data-property="constructionType"
                                            class="construction-edit-input w-full text-xs border rounded p-1">
                                        ${Array.from(constructionTypeSelect.options).map(option => 
                                            `<option value="${option.value}" ${option.value === construction.constructionType ? 'selected' : ''}
                                             ${option.dataset.color ? `data-color="${option.dataset.color}"` : ''}>
                                                ${option.text}
                                            </option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="flex justify-end">
                                    <button class="delete-construction text-red-500 hover:text-red-700 text-xs" data-id="${construction.id}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        constructionElement.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div class="flex items-center truncate>
                                    <div class="color-preview mr-2" style="background-color: ${construction.color};"></div>
                                    <div class="truncate">
                                        <div class="font-medium truncate">${construction.constructionType}</div>
                                        <div class="text-xs text-gray-500">${construction.fromDepth}m - ${construction.toDepth}m</div>
                                    </div>
                                </div>
                                <button class="delete-construction opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 text-xs" data-id="${construction.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        `;
                    }
                    
                    constructionList.appendChild(constructionElement);
                });
                
                // Add delete event listeners
                document.querySelectorAll('.delete-construction').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        constructionElements = constructionElements.filter(construction => construction.id !== id);
                        updateConstructionList();
                        generateBorehole();
                        showAlert('Construction element removed', 'success');
                    });
                });
            }
            
            function updateAnnulusList() {
                if (annulusElements.length === 0) {
                    annulusList.innerHTML = `
                        <div class="empty-state p-2 text-center text-gray-400 text-xs">
                            <i class="fas fa-fill-drip text-lg mb-1 text-gray-300"></i>
                            <p>No annulus added</p>
                        </div>
                    `;
                    return;
                }
                
                const sortedAnnulus = [...annulusElements].sort((a, b) => a.fromDepth - b.fromDepth);
                annulusList.innerHTML = '';
                
                sortedAnnulus.forEach(annulus => {
                    const annulusElement = document.createElement('div');
                    annulusElement.className = 'compact-list-item hover:bg-gray-50 group';
                    annulusElement.dataset.id = annulus.id;
                    
                    if (isEditMode) {
                        annulusElement.innerHTML = `
                            <div class="grid grid-cols-4 gap-1 items-center">
                                <div>
                                    <input type="number" step="0.5" value="${annulus.fromDepth}" 
                                           data-id="${annulus.id}" data-property="fromDepth"
                                           class="annulus-edit-input w-full text-xs border rounded p-1">
                                </div>
                                <div>
                                    <input type="number" step="0.5" value="${annulus.toDepth}" 
                                           data-id="${annulus.id}" data-property="toDepth"
                                           class="annulus-edit-input w-full text-xs border rounded p-1">
                                </div>
                                <div>
                                    <select data-id="${annulus.id}" data-property="annulusType"
                                            class="annulus-edit-input w-full text-xs border rounded p-1">
                                        ${Array.from(annulusTypeSelect.options).map(option => 
                                            `<option value="${option.value}" ${option.value === annulus.annulusType ? 'selected' : ''}
                                             ${option.dataset.color ? `data-color="${option.dataset.color}"` : ''}>
                                                ${option.text}
                                            </option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="flex justify-end">
                                    <button class="delete-annulus text-red-500 hover:text-red-700 text-xs" data-id="${annulus.id}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        annulusElement.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div class="flex items-center truncate">
                                    <div class="color-preview mr-2" style="background-color: ${annulus.color};"></div>
                                    <div class="truncate">
                                        <div class="font-medium truncate">${annulus.annulusType}</div>
                                        <div class="text-xs text-gray-500">${annulus.fromDepth}m - ${annulus.toDepth}m</div>
                                    </div>
                                </div>
                                <button class="delete-annulus opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 text-xs" data-id="${annulus.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        `;
                    }
                    
                    annulusList.appendChild(annulusElement);
                });
                
                // Add delete event listeners
                document.querySelectorAll('.delete-annulus').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        annulusElements = annulusElements.filter(annulus => annulus.id !== id);
                        updateAnnulusList();
                        generateBorehole();
                        showAlert('Annulus element removed', 'success');
                    });
                });
            }
            
            function generateBorehole() {
                // Clear existing borehole
                geologyLeft.innerHTML = '';
                annulusConstruction.innerHTML = '';
                boreConstruction.innerHTML = '';
                waterLevel.innerHTML = '';
                geologyRight.innerHTML = '';
                depthScale.innerHTML = '';
                groundLevel.innerHTML = '';
                
                // Find the minimum depth (for headworks that might be above ground)
                let minDepth = 0;
                constructionElements.forEach(construction => {
                    if (construction.fromDepth < minDepth) minDepth = construction.fromDepth;
                    if (construction.toDepth < minDepth) minDepth = construction.toDepth;
                });
                
                // Calculate total height needed (from minDepth to totalHoleDepth)
                const depthRange = totalHoleDepth - minDepth;
                const containerHeight = depthRange * 2 * segmentHeight;
                
                // Set container heights
                boreholeContainer.style.height = `${containerHeight}px`;
                geologyLeft.style.height = `${containerHeight}px`;
                annulusConstruction.style.height = `${containerHeight}px`;
                boreConstruction.style.height = `${containerHeight}px`;
                waterLevel.style.height = `${containerHeight}px`;
                geologyRight.style.height = `${containerHeight}px`;
                depthScale.style.height = `${containerHeight}px`;
                
                // Set wrapper height to match container
                boreholeWrapper.style.height = `${containerHeight}px`;
                
                // Create ground level indicator (at 0m)
                const groundLevelPosition = (0 - minDepth) * 2 * segmentHeight;
                const groundLevelLine = document.createElement('div');
                groundLevelLine.className = 'ground-level';
                groundLevelLine.style.top = `${groundLevelPosition}px`;
                
                const groundLevelLabel = document.createElement('div');
                groundLevelLabel.className = 'ground-level-label';
                groundLevelLabel.style.top = `${groundLevelPosition}px`;
                groundLevelLabel.textContent = 'Ground Level (0m)';
                
                groundLevel.appendChild(groundLevelLine);
                groundLevel.appendChild(groundLevelLabel);
                
                // Create depth markers (every 10m)
                for (let i = Math.ceil(minDepth / 10) * 10; i <= totalHoleDepth; i += 10) {
                    const markerPosition = (i - minDepth) * 2 * segmentHeight;
                    const marker = document.createElement('div');
                    marker.className = 'depth-marker';
                    marker.style.top = `${markerPosition}px`;
                    marker.textContent = `${i}`;
                    depthScale.appendChild(marker);
                }
                
                // Create geology segments (left side)
                for (let i = 0; i < depthRange * 2; i++) {
                    const currentDepth = minDepth + (i * 0.5);
                    const segment = document.createElement('div');
                    segment.className = 'layer-segment';
                    segment.style.height = `${segmentHeight}px`;
                    
                    // Find which layer this segment belongs to
                    const matchingLayer = layers.find(layer => 
                        currentDepth >= layer.fromDepth && currentDepth < layer.toDepth
                    );
                    
                    segment.style.backgroundColor = matchingLayer 
                        ? hexToRgba(matchingLayer.color, 0.8) 
                        : 'rgba(243, 244, 246, 0.8)';
                    
                    geologyLeft.appendChild(segment);
                }
                
                // Create geology segments (right side)
                for (let i = 0; i < depthRange * 2; i++) {
                    const currentDepth = minDepth + (i * 0.5);
                    const segment = document.createElement('div');
                    segment.className = 'layer-segment';
                    segment.style.height = `${segmentHeight}px`;
                    
                    // Find which layer this segment belongs to
                    const matchingLayer = layers.find(layer => 
                        currentDepth >= layer.fromDepth && currentDepth < layer.toDepth
                    );
                    
                    if (matchingLayer) {
                        segment.style.backgroundColor = hexToRgba(matchingLayer.color, 0.8);
                        
                        // Add right label for the layer (only at the middle of the layer)
                        const layerMiddleDepth = (matchingLayer.fromDepth + matchingLayer.toDepth) / 2;
                        if (Math.abs(currentDepth - layerMiddleDepth) < 0.25) {
                            const rightLabel = document.createElement('div');
                            rightLabel.className = 'right-label';
                            rightLabel.style.top = `${i * segmentHeight}px`;
                            rightLabel.innerHTML = `
                                <div class="font-medium">${matchingLayer.materialType}</div>
                                <div class="text-xs text-gray-500">${matchingLayer.fromDepth}m - ${matchingLayer.toDepth}m</div>
                            `;
                            
                            geologyRight.appendChild(rightLabel);
                        }
                    } else {
                        segment.style.backgroundColor = 'rgba(243, 244, 246, 0.8)';
                    }
                    
                    geologyRight.appendChild(segment);
                }
                
                // Add annulus construction elements
                annulusElements.forEach(annulus => {
                    const fromPosition = (annulus.fromDepth - minDepth) * 2 * segmentHeight;
                    const height = (annulus.toDepth - annulus.fromDepth) * 2 * segmentHeight;
                    
                    if (height <= 0) return;
                    
                    const annulusContainer = document.createElement('div');
                    annulusContainer.className = 'absolute';
                    annulusContainer.style.top = `${fromPosition}px`;
                    annulusContainer.style.height = `${height}px`;
                    annulusContainer.style.width = '80px';
                    annulusContainer.style.left = '50%';
                    annulusContainer.style.transform = 'translateX(-50%)';
                    annulusContainer.style.backgroundColor = annulus.color;
                    annulusContainer.style.borderLeft = '1px solid rgba(0,0,0,0.2)';
                    annulusContainer.style.borderRight = '1px solid rgba(0,0,0,0.2)';
                    annulusContainer.style.zIndex = '1';
                    annulusContainer.style.borderRadius = '3px';
                    
                    // Add annulus label on the left side
                    const label = document.createElement('div');
                    label.className = 'annulus-label';
                    label.style.top = `${height / 2 - 10}px`; // Center vertically
                    label.innerHTML = `
                        <div class="font-medium">${annulus.annulusType}</div>
                        <div class="text-xs text-gray-500">${annulus.fromDepth}m - ${annulus.toDepth}m</div>
                    `;
                    
                    annulusContainer.appendChild(label);
                    annulusConstruction.appendChild(annulusContainer);
                });
                
                // Add water level if specified
                if (waterDepth !== null && waterDepth < totalHoleDepth) {
                    const fromPosition = (waterDepth - minDepth) * 2 * segmentHeight;
                    const height = (totalHoleDepth - waterDepth) * 2 * segmentHeight;
                    
                    if (height > 0) {
                        const waterContainer = document.createElement('div');
                        waterContainer.className = 'water-level';
                        waterContainer.style.top = `${fromPosition}px`;
                        waterContainer.style.height = `${height}px`;
                        waterContainer.style.backgroundColor = 'rgba(0, 119, 255, 0.3)';
                        waterContainer.style.borderLeft = '1px solid rgba(0, 119, 255, 0.7)';
                        waterContainer.style.borderRight = '1px solid rgba(0, 119, 255, 0.7)';
                        waterContainer.style.zIndex = '4';
                        waterContainer.style.borderRadius = '3px';
                        
                        // Add water level label
                        const label = document.createElement('div');
                        label.className = 'water-level-label';
                        label.style.top = '8px';
                        label.innerHTML = `
                            <i class="fas fa-tint mr-1"></i> Water Level
                            <div class="text-xs">${waterDepth}m depth</div>
                        `;
                        waterContainer.appendChild(label);
                        
                        waterLevel.appendChild(waterContainer);
                    }
                }
                
                // Add construction elements
                constructionElements.forEach(construction => {
                    const fromPosition = (construction.fromDepth - minDepth) * 2 * segmentHeight;
                    const height = (construction.toDepth - construction.fromDepth) * 2 * segmentHeight;
                    
                    if (height <= 0) return;
                    
                    const constructionContainer = document.createElement('div');
                    constructionContainer.className = 'absolute';
                    constructionContainer.style.top = `${fromPosition}px`;
                    constructionContainer.style.height = `${height}px`;
                    constructionContainer.style.width = '40px';
                    constructionContainer.style.left = '50%';
                    constructionContainer.style.transform = 'translateX(-50%)';
                    constructionContainer.style.backgroundColor = construction.color;
                    constructionContainer.style.borderLeft = '1px solid rgba(0,0,0,0.2)';
                    constructionContainer.style.borderRight = '1px solid rgba(0,0,0,0.2)';
                    constructionContainer.style.zIndex = '2';
                    constructionContainer.style.borderRadius = '3px';
                    
                    // Add construction label
                    const label = document.createElement('div');
                    label.className = 'segment-label';
                    label.innerHTML = `
                        <div class="text-xs">${construction.constructionType}</div>
                        <div class="text-2xs">${construction.fromDepth}m - ${construction.toDepth}m</div>
                    `;
                    constructionContainer.appendChild(label);
                    
                    boreConstruction.appendChild(constructionContainer);
                });
            }
            
            // Helper function to convert hex color to rgba with transparency
            function hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
      // Export to PDF function
            function exportToPDF() {
                // Show loading state
                exportBtn.classList.add('exporting');
                
                // Get the borehole container
                const element = document.getElementById('boreholeContainer');
                
                // Get the bore ID for filename
                const boreId = document.getElementById('boreId').value || 'borehole';
                
                // Use html2canvas to capture the element as an image
                html2canvas(element, {
                    scale: 2, // Higher quality
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    scrollX: 0,
                    scrollY: -window.scrollY
                }).then(canvas => {
                    // Create a new jsPDF instance
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm'
                    });
                    
                    // Calculate dimensions
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 190; // A4 width (210mm) with margins
                    const pageHeight = 297; // A4 height (297mm)
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    // Add the image to the PDF
                    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                    
                  // get the page width
const pageWidth = pdf.internal.pageSize.getWidth();

// Add title in the top-right corner
pdf.setFontSize(10);
pdf.setTextColor(40, 40, 40);
pdf.text(
  boreId,
  pageWidth - 10,   // 10 mm from right edge
  20,               // 20 mm down from top
  { align: 'right' }
);

// Add current date also in the top-right
const today = new Date();
pdf.setFontSize(10);
pdf.text(
  `Generated on: ${today.toLocaleDateString()}`,
  pageWidth - 10,   // same right margin
  25,               // just below the title
  { align: 'right' }
);

                    // Add footer
                    pdf.setFontSize(8);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text(' Borehole Schematic Generator', 105, 287, { align: 'center' });
                    
                    // Save the PDF
                    pdf.save(`${boreId}_borehole_schematic.pdf`);
                    
                    // Hide loading state
                    exportBtn.classList.remove('exporting');
                    
                    // Show success notification
                    showAlert('PDF exported successfully', 'success');
                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    showAlert('Error generating PDF. Please try again.', 'error');
                    exportBtn.classList.remove('exporting');
                });
            }
            
            // Initialize the borehole display
            generateBorehole();
        });
    </script>
</body>
</html>
